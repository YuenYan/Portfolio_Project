--Percentage Death per Cases
SELECT 
   location,
   date, 
   total_cases,
   total_deaths, 
   (total_deaths/total_cases)*100 AS percentage_death
FROM `covid-326506.Covid19.CovidDeath`
WHERE continent IS NOT NULL  
ORDER BY location, date;
 
--Percentage Infections per Population
SELECT location,date,population,total_cases, (total_cases/population)*100 AS percentage_infection
FROM `covid-326506.Covid19.CovidDeath` 
WHERE continent IS NOT NULL 
ORDER BY location, date;
 
-- Locations of Top 10 highest infections per population
SELECT location, population, MAX(total_cases) AS HighestInfectionCount, MAX((total_cases/population))*100 AS percentage_infection
FROM `covid-326506.Covid19.CovidDeath`
WHERE continent IS NOT NULL  
GROUP BY location, population
ORDER BY percentage_infection DESC
LIMIT 10;
 
-- Locations of Top 10 highest death count
SELECT location, MAX(total_deaths) AS HighestDeathCount
FROM `covid-326506.Covid19.CovidDeath` 
WHERE continent IS NOT NULL 
GROUP BY location
ORDER BY HighestDeathCount DESC
LIMIT 10;
 
-- Continent, infections per population
SELECT continent, population, MAX(total_cases) AS HighestInfectionCount, MAX((total_cases/population))*100 AS percentage_infection
FROM `covid-326506.Covid19.CovidDeath`
WHERE continent IS NOT NULL  
GROUP BY continent, population
ORDER BY percentage_infection DESC
LIMIT 10;
 
-- Continent, of Top 10 highest death count
SELECT continent, MAX(total_deaths) AS HighestDeathCount
FROM `covid-326506.Covid19.CovidDeath` 
WHERE continent IS NOT NULL 
GROUP BY continent
ORDER BY HighestDeathCount DESC
LIMIT 10;
 
-- Global NUmber
SELECT
   date,
   SUM(new_cases) AS new_cases,
   SUM(new_deaths) AS new_deaths,
   SUM(total_cases) AS total_cases,
   SUM(total_deaths) AS total_deaths
FROM `covid-326506.Covid19.CovidDeath`
WHERE continent IS NOT NULL  
GROUP BY date
Order BY date; 

--CTE
WITH Vac_Pop AS (
    SELECT  Dea.continent, Dea.location, Dea.date, Dea.population, Vac.new_vaccinations, 
       SUM(Vac.new_vaccinations) OVER (Partition By Dea.location ORDER BY Dea.location, Dea.date) AS accumulated_vaccinations
    FROM `covid-326506.Covid19.CovidDeath` AS Dea
    JOIN `covid-326506.Covid19.CovidVaccinations` AS Vac
       ON  Dea.date = Vac.date
       AND Dea.location = Vac.location
    WHERE Dea.continent IS NOT NULL
)
 
SELECT *, (accumulated_vaccinations/population)*100 AS percentage_vaccinated
FROM Vac_Pop 
ORDER BY continent, location, date;
 
 
--Temp Table
CREATE TEMP TABLE Vac_Population AS 
    SELECT  Dea.continent, Dea.location, Dea.date, Dea.population, Vac.new_vaccinations, 
       SUM(Vac.new_vaccinations) OVER (Partition By Dea.location ORDER BY Dea.location, Dea.date) AS accumulated_vaccinations
    FROM `covid-326506.Covid19.CovidDeath` AS Dea
    JOIN `covid-326506.Covid19.CovidVaccinations` AS Vac
       ON  Dea.date = Vac.date
       AND Dea.location = Vac.location
    WHERE Dea.continent IS NOT NULL;
 
SELECT * ,(accumulated_vaccinations/population)*100 AS percentage_vaccinated
FROM Vac_Population 
ORDER BY continent, location, date
